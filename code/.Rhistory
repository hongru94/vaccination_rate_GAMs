library(mgcv)
library(gratia)
library(tidyr)
# create detect outlier function
detect_outlier <- function(x) {
# calculate first quantile
Quantile1 <- quantile(x, probs=.25)
# calculate third quantile
Quantile3 <- quantile(x, probs=.75)
# calculate inter quartile range
IQR = Quantile3-Quantile1
# return true or false
x > Quantile3 + (IQR*1.5) | x < Quantile1 - (IQR*1.5)
}
# create remove outlier function
remove_outlier <- function(dataframe,
columns=names(dataframe)) {
# for loop to traverse in columns vector
for (col in columns) {
# remove observation if it satisfies outlier function
dataframe <- dataframe[!detect_outlier(dataframe[[col]]), ]
}
# return dataframe
print("Remove outliers")
print(dataframe)
}
######################
## All waves all weeks
######################
df_hosp <- read.csv('/Users/hongrudu/Desktop/submission_file/Data/hospitalization_rate.csv')
df_hosp<-df_hosp[!is.na(df_hosp$Relative_hospitalization_rate),]
df_hosp <- df_hosp[!df_hosp$FIPS %in% c(33, 54),]
df_hosp <- remove_outlier(df_hosp, c("Relative_hospitalization_rate"))
k_value = 3
model_1_all <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_all)
plot(model_1_all, page = 1)
concurvity(model_1_all)
gam.check(model_1_all,rep = 100, page = 1)
df_hosp_pre_delta <- df_hosp[df_hosp$Dominant_variant == "Pre-Delta",]
df_hosp_pre_delta <- df_hosp_pre_delta[!is.na(df_hosp_pre_delta$Relative_hospitalization_rate),]
df_hosp_pre_delta <- remove_outlier(df_hosp_pre_delta, c("Relative_hospitalization_rate"))
k_value = 3
model_1_pre_delta <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_pre_delta,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_pre_delta)
plot(model_1_pre_delta, page = 1)
concurvity(model_1_pre_delta)
gam.check(model_1_pre_delta,rep = 100, page = 1)
df_hosp_omicron <- df_hosp[df_hosp$Dominant_variant == "Omicron",]
df_hosp_omicron <- df_hosp_omicron[!is.na(df_hosp_omicron$Relative_hospitalization_rate),]
df_hosp_omicron <- df_hosp_omicron[!df_hosp_omicron$FIPS %in% c(33, 37, 54),]
df_hosp_omicron <- remove_outlier(df_hosp_omicron, c("Relative_hospitalization_rate"))
k_value = 3
model_1_omicron <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_omicron,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_omicron)
plot(model_1_omicron, page = 1)
concurvity(model_1_omicron)
gam.check(model_1_omicron,rep = 100, page = 1)
################
###Compare 3 waves
comp <- compare_smooths(model_1_pre_delta, model_1_delta, model_1_omicron)
rest <- unnest(comp,data)
################
###Compare 3 waves
comp <- compare_smooths(model_1_pre_delta, model_1_delta, model_1_omicron)
df_hosp_delta <- df_hosp[df_hosp$Dominant_variant == "Delta",]
df_hosp_delta <- df_hosp_delta[!is.na(df_hosp_delta$Relative_hospitalization_rate),]
df_hosp_delta <- remove_outlier(df_hosp_delta, c("Relative_hospitalization_rate"))
k_value = 3
model_1_delta <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_delta,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_delta)
plot(model_1_delta, page = 1)
concurvity(model_1_delta)
gam.check(model_1_delta,rep = 100, page = 1)
write.csv(rest, '/Users/hongrudu/Documents/GitHub/vaccination_rate_GAMs/results/model_1_all_waves.csv')
comp <- compare_smooths(model_1_all, model_1_all)
rest <- unnest(comp,data)
write.csv(rest, '/Users/hongrudu/Documents/GitHub/vaccination_rate_GAMs/results/model_1_all_waves.csv')
df_hosp_pre_delta <- df_hosp[df_hosp$Dominant_variant == "Pre-Delta",]
df_hosp_pre_delta <- df_hosp_pre_delta[!is.na(df_hosp_pre_delta$Relative_hospitalization_rate),]
df_hosp_pre_delta <- remove_outlier(df_hosp_pre_delta, c("Relative_hospitalization_rate"))
k_value = 3
model_1_pre_delta <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_pre_delta,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_pre_delta)
plot(model_1_pre_delta, page = 1)
concurvity(model_1_pre_delta)
gam.check(model_1_pre_delta,rep = 100, page = 1)
df_hosp_delta <- df_hosp[df_hosp$Dominant_variant == "Delta",]
df_hosp_delta <- df_hosp_delta[!is.na(df_hosp_delta$Relative_hospitalization_rate),]
df_hosp_delta <- remove_outlier(df_hosp_delta, c("Relative_hospitalization_rate"))
k_value = 3
model_1_delta <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_delta,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_delta)
plot(model_1_delta, page = 1)
concurvity(model_1_delta)
gam.check(model_1_delta,rep = 100, page = 1)
df_hosp_omicron <- df_hosp[df_hosp$Dominant_variant == "Omicron",]
df_hosp_omicron <- df_hosp_omicron[!is.na(df_hosp_omicron$Relative_hospitalization_rate),]
df_hosp_omicron <- df_hosp_omicron[!df_hosp_omicron$FIPS %in% c(33, 37, 54),]
df_hosp_omicron <- remove_outlier(df_hosp_omicron, c("Relative_hospitalization_rate"))
k_value = 3
model_1_omicron <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_omicron,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_omicron)
plot(model_1_omicron, page = 1)
concurvity(model_1_omicron)
gam.check(model_1_omicron,rep = 100, page = 1)
################
###Compare 3 waves
comp <- compare_smooths(model_1_pre_delta, model_1_delta, model_1_omicron)
rest <- unnest(comp,data)
draw(comp)
write.csv(rest, '/Users/hongrudu/Documents/GitHub/vaccination_rate_GAMs/results/compare_3_waves.csv')
model_2_omicron <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2,
Relative_booster_vaccination_rate_lag2, k = 4) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_omicron,
family = Gamma(link = 'log'), select = TRUE)
summary(model_2_omicron)
plot_data <- plot(model_2_omicron, page =1, scheme = 1)
model_2_omicron <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2,
Relative_booster_vaccination_rate_lag2, k = 4) +
+ s(Relative_Past_16_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_omicron,
family = Gamma(link = 'log'), select = TRUE)
summary(model_2_omicron)
plot_data <- plot(model_2_omicron, page =1, scheme = 1)
concurvity(model_2_omicron)
gam.check(model_2_omicron,rep = 100, page = 1)
x1 <- plot_data[[1]]$x
x2 <- plot_data[[1]]$y
fit <- plot_data[[1]]$fit
se <- plot_data[[1]]$se
write.table(x1, file='/Users/hongrudu/Documents/GitHub/vaccination_rate_GAMs/results/interaction_x1.tsv', quote=FALSE, sep=',', col.names = NA)
write.table(x2, file='/Users/hongrudu/Documents/Projects/COVID-severity/final_version/gam_results/interaction_x2.tsv', quote=FALSE, sep=',', col.names = NA)
write.table(fit, file='/Users/hongrudu/Documents/Projects/COVID-severity/final_version/gam_results/interaction_fit.tsv', quote=FALSE, sep=',', col.names = NA)
write.table(x2, file='/Users/hongrudu/Documents/GitHub/vaccination_rate_GAMs/results/interaction_x2.tsv', quote=FALSE, sep=',', col.names = NA)
write.table(fit, file='/Users/hongrudu/Documents/GitHub/vaccination_rate_GAMs/results/interaction_fit.tsv', quote=FALSE, sep=',', col.names = NA)
write.csv(rest, '/Users/hongrudu/Documents/GitHub/vaccination_rate_GAMs/results/model_2_omicron.csv')
comp <- compare_smooths(model_2_omicron, model_2_omicron)
rest <- unnest(comp,data)
draw(comp)
write.csv(rest, '/Users/hongrudu/Documents/GitHub/vaccination_rate_GAMs/results/model_2_omicron.csv')
model_2_omicron <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2,
Relative_booster_vaccination_rate_lag2, k = 4) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_omicron,
family = Gamma(link = 'log'), select = TRUE)
comp <- compare_smooths(model_2_omicron, model_2_omicron)
rest <- unnest(comp,data)
draw(comp)
write.csv(rest, '/Users/hongrudu/Documents/GitHub/vaccination_rate_GAMs/results/model_2_omicron.csv')
######################
## All waves all weeks
######################
df_hosp <- read.csv('/Users/hongrudu/Documents/GitHub/vaccination_rate_GAMs/data/df_hosp.csv')
df_hosp<-df_hosp[!is.na(df_hosp$Relative_hospitalization_rate),]
df_hosp <- df_hosp[!df_hosp$FIPS %in% c(33, 54),]
df_hosp <- remove_outlier(df_hosp, c("Relative_hospitalization_rate"))
k_value = 3
model_1_all <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_all)
plot(model_1_all, page = 1)
concurvity(model_1_all)
gam.check(model_1_all,rep = 100, page = 1)
comp <- compare_smooths(model_1_all, model_1_all)
rest <- unnest(comp,data)
write.csv(rest, '/Users/hongrudu/Documents/GitHub/vaccination_rate_GAMs/results/model_1_all_waves.csv')
df_hosp_pre_delta <- df_hosp[df_hosp$Dominant_variant == "Pre-Delta",]
df_hosp_pre_delta <- df_hosp_pre_delta[!is.na(df_hosp_pre_delta$Relative_hospitalization_rate),]
df_hosp_pre_delta <- remove_outlier(df_hosp_pre_delta, c("Relative_hospitalization_rate"))
k_value = 3
model_1_pre_delta <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_pre_delta,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_pre_delta)
plot(model_1_pre_delta, page = 1)
concurvity(model_1_pre_delta)
gam.check(model_1_pre_delta,rep = 100, page = 1)
df_hosp_delta <- df_hosp[df_hosp$Dominant_variant == "Delta",]
df_hosp_delta <- df_hosp_delta[!is.na(df_hosp_delta$Relative_hospitalization_rate),]
df_hosp_delta <- remove_outlier(df_hosp_delta, c("Relative_hospitalization_rate"))
k_value = 3
model_1_delta <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_delta,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_delta)
plot(model_1_delta, page = 1)
concurvity(model_1_delta)
gam.check(model_1_delta,rep = 100, page = 1)
df_hosp_omicron <- df_hosp[df_hosp$Dominant_variant == "Omicron",]
df_hosp_omicron <- df_hosp_omicron[!is.na(df_hosp_omicron$Relative_hospitalization_rate),]
df_hosp_omicron <- df_hosp_omicron[!df_hosp_omicron$FIPS %in% c(33, 37, 54),]
df_hosp_omicron <- remove_outlier(df_hosp_omicron, c("Relative_hospitalization_rate"))
k_value = 3
model_1_omicron <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_omicron,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_omicron)
plot(model_1_omicron, page = 1)
concurvity(model_1_omicron)
gam.check(model_1_omicron,rep = 100, page = 1)
################
###Compare 3 waves
comp <- compare_smooths(model_1_pre_delta, model_1_delta, model_1_omicron)
rest <- unnest(comp,data)
draw(comp)
write.csv(rest, '/Users/hongrudu/Documents/GitHub/vaccination_rate_GAMs/results/compare_3_waves.csv')
summary(mod_others_3)
summary(mod_all)
library(mgcv)
library(gratia)
library(tidyr)
# create detect outlier function
detect_outlier <- function(x) {
# calculate first quantile
Quantile1 <- quantile(x, probs=.25)
# calculate third quantile
Quantile3 <- quantile(x, probs=.75)
# calculate inter quartile range
IQR = Quantile3-Quantile1
# return true or false
x > Quantile3 + (IQR*1.5) | x < Quantile1 - (IQR*1.5)
}
# create remove outlier function
remove_outlier <- function(dataframe,
columns=names(dataframe)) {
# for loop to traverse in columns vector
for (col in columns) {
# remove observation if it satisfies outlier function
dataframe <- dataframe[!detect_outlier(dataframe[[col]]), ]
}
# return dataframe
print("Remove outliers")
print(dataframe)
}
######################
## All waves all weeks
######################
df_hosp <- read.csv('/Users/hongrudu/Documents/GitHub/vaccination_rate_GAMs/data/df_hosp.csv')
df_hosp<-df_hosp[!is.na(df_hosp$Relative_hospitalization_rate),]
df_hosp <- df_hosp[!df_hosp$FIPS %in% c(33, 54),]
df_hosp <- remove_outlier(df_hosp, c("Relative_hospitalization_rate"))
k_value = 3
model_1_all <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_all)
model_1_all <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value) +
s(Relative_gas_station_lag2, k = k_value) +
s(Relative_religious_organization_lag2, k = k_value), data = df_hosp,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_all)
concurvity(model_1_all)
df_hosp_pre_delta <- df_hosp[df_hosp$Dominant_variant == "Pre-Delta",]
df_hosp_pre_delta <- df_hosp_pre_delta[!is.na(df_hosp_pre_delta$Relative_hospitalization_rate),]
df_hosp_pre_delta <- remove_outlier(df_hosp_pre_delta, c("Relative_hospitalization_rate"))
k_value = 3
model_1_pre_delta <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value) +
s(Relative_gas_station_lag2, k = k_value) +
s(Relative_religious_organization_lag2, k = k_value), data = df_hosp_pre_delta,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_pre_delta)
concurvity(model_1_pre_delta)
df_hosp_delta <- df_hosp[df_hosp$Dominant_variant == "Delta",]
df_hosp_delta <- df_hosp_delta[!is.na(df_hosp_delta$Relative_hospitalization_rate),]
df_hosp_delta <- remove_outlier(df_hosp_delta, c("Relative_hospitalization_rate"))
k_value = 3
model_1_delta <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value) +
s(Relative_gas_station_lag2, k = k_value) +
s(Relative_religious_organization_lag2, k = k_value), data = df_hosp_delta,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_delta)
concurvity(model_1_delta)
df_hosp_omicron <- df_hosp[df_hosp$Dominant_variant == "Omicron",]
df_hosp_omicron <- df_hosp_omicron[!is.na(df_hosp_omicron$Relative_hospitalization_rate),]
df_hosp_omicron <- df_hosp_omicron[!df_hosp_omicron$FIPS %in% c(33, 37, 54),]
df_hosp_omicron <- remove_outlier(df_hosp_omicron, c("Relative_hospitalization_rate"))
k_value = 3
model_1_omicron <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value) +
s(Relative_gas_station_lag2, k = k_value) +
s(Relative_religious_organization_lag2, k = k_value), data = df_hosp_omicron,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_omicron)
concurvity(model_1_omicron)
model_1_all <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_all)
concurvity(model_1_all)
model_1_pre_delta <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_pre_delta,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_pre_delta)
concurvity(model_1_pre_delta)
model_1_delta <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_delta,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_delta)
concurvity(model_1_delta)
model_1_omicron <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_omicron,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_omicron)
concurvity(model_1_omicron)
summary(model_1_all)
k_value = 10
model_1_all <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_all)
summary(model_1_pre_delta)
k_value = 10
model_1_pre_delta <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_pre_delta,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_pre_delta)
summary(model_1_delta)
k_value = 10
model_1_delta <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_delta,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_delta)
summary(model_1_omicron)
k_value = 10
model_1_omicron <- gam(Relative_hospitalization_rate ~ s(Relative_completed_primary_series_rate_lag2, k = k_value) +
+ s(Relative_Past_12_week_infections_lag4, k = k_value) +
s(Relative_full_service_restaurant_lag2, k = k_value) +
s(Relative_university_lag2, k = k_value) +
s(Relative_gym_lag2, k = k_value) +
s(Relative_office_of_physician_lag2, k = k_value) +
s(Relative_Weekly_testing_lag2, k = k_value) +
s(Relative_Government_Response_Index_lag2, k = k_value), data = df_hosp_omicron,
family = Gamma(link = 'log'), select = TRUE)
summary(model_1_omicron)
